Sub Button2_Click()
'Sheets("Sheet1").Delete
'Sheets("MISC").Delete
Sheets.Add.name = "Check"
Dim ws As Worksheet
Dim wb As Workbook
Set wb = ThisWorkbook
For Each ws In wb.Worksheets

Application.ScreenUpdating = True

Dim reet As Long
Dim item As String
Dim wsName As String
Dim freq As Long
Dim ranger As Long
Dim rangew As Long
Dim sumqty As Long
Dim avgShip As Long
Dim txnMonth As Long
Dim product As String
Dim yman As Long




wsName = ws.name
If wsName = "Ledge" Then
wsName = "RISO"
End If

Sheets("Ledge").Select
ranger = Sheets("Ledge").UsedRange.Rows.count

Sheets(wsName).Select
rangew = Sheets(wsName).UsedRange.Rows.count
For reet = 2 To rangew
item = Sheets(wsName).Cells(reet, 5)
yman = 0


 Sheets("Ledge").Select
 Sheets("Ledge").Columns("A:A").Select
For i = 2 To ranger
If item = Sheets("Ledge").Cells(i, 1) Then
product = Sheets("Ledge").Cells(i, 8)
i = ranger
yman = 1
End If
Next i
   
    Selection.AutoFilter
    Sheets("Ledge").Range("$A$1:$A$" & ranger).AutoFilter Field:=1, Criteria1:= _
    item
    Dim myTable As Range
    Set myTable = Sheets("Ledge").AutoFilter.Range
    
    
    sumqty = Abs(Application.WorksheetFunction.sum(Sheets("Ledge").Columns(7).SpecialCells(xlCellTypeVisible)))
    
   If yman = 1 Then
    'copy myTable to new sheet
    Sheets("Check").Cells.Clear
    Sheets("Ledge").Cells.Select
    Selection.SpecialCells(xlCellTypeVisible).Copy
    Sheets("Check").Select
    Sheets("Check").Cells.Select
    ActiveSheet.PasteSpecial
    
    'TOP LOCATION
    Dim ct As Long
    Dim FL As Long
    Dim CA As Long
    Dim qwe As Long
    Dim win As Long
    Dim loc As String
    Application.ScreenUpdating = True
    DoEvents
    Sheets("Check").Select
    If Sheets("Check").Cells(2, 1) = "Item No." Then
    Sheets("Check").Cells.Clear
    End If
    FL = 0
    CA = 0
    ct = Sheets("Check").UsedRange.Rows.count
    
    For qwe = 2 To ct
    If Sheets("Check").Cells(qwe, 6) = "COMPTON" Then
    CA = CA + Sheets("Check").Cells(qwe, 7)
    ElseIf Sheets("Check").Cells(qwe, 6) = "FLORIDA" Then
    FL = FL + Sheets("Check").Cells(qwe, 7)
    Else
    'MsgBox ("NO LOCATION")
    End If
    Next qwe
    CA = Abs(CA)
    FL = Abs(FL)
    
    If CA > FL Then
    win = CA
    loc = "COMPTON"
    ElseIf FL > CA Then
    win = FL
    loc = "FLORIDA"
    End If
    Else
    win = 0
    loc = "smd"
    End If
    'DONE use win for top location sold value and loc for location
    
    
    'TOP MONTH
    Sheets("Check").Select
    Dim cte As Long
    Dim qwer As Long
    Dim arr(0 To 13) As Long
    Dim max As Long
    Dim mon As Long
    
    arr(1) = 0
    arr(2) = 0
    arr(3) = 0
    arr(4) = 0
    arr(5) = 0
    arr(6) = 0
    arr(7) = 0
    arr(8) = 0
    arr(9) = 0
    arr(10) = 0
    arr(11) = 0
    arr(12) = 0
    
    cte = Sheets("Check").UsedRange.Rows.count
    For qwer = 2 To cte
    Dim index As Long
    index = Month(Sheets("Check").Cells(qwer, 2))
    arr(index) = arr(index) + Sheets("Check").Cells(qwer, 7)
    Next qwer
   
    max = 0
    mon = 0
    For qwer = 1 To 12
    If Abs(arr(qwer)) > max Then
    max = Abs(arr(qwer))
    mo = qwer
    End If
    Next qwer
    'DONE MAX gvies the amount sold in a month and MO is the month #
    
    'TOP CUSTOMER
    'Dim countt As Long
    ' im ctee As Long
    'Dim qwert As Long
    'Dim qwerty As Long
    'Dim coll As Object
    'Dim custCode As String
    'Dim numOrder As Long
    'Dim chek As Object
    'Set chek = CreateObject("System.Collections.ArrayList")
    'Set coll = CreateObject("System.Collections.ArrayList")
    'cte = Sheets("Check").UsedRange.Rows.count
    'For qwert = 2 To cte
    'If coll.Contains(Sheets("Check").Cells(qwert, 3)) = False Then
    'coll.Add (Sheets("Check").Cells(qwert, 3))
    'chek.Add (0)
    'End If
    'Next qwert
    
   
    'For qwerty = 0 To coll.count - 1
    'Dim namer As String
    'namer = coll(qwerty)
    'For countt = 2 To cte
    'If Sheets("Check").Cells(countt, 3) = namer Then
    'chek(qwerty) = chek(qwerty) + Sheets("Check").Cells(countt, 7)
    'End If
   ' Next countt
   ' Next qwerty
    
   ' Dim nCount As Long
   ' Dim comp As Long
   ' comp = 0
   ' For nCount = 0 To chek.count - 1
   ' If Abs(chek(nCount)) > comp Then
   ' comp = Abs(chek(nCount))
   ' End If
   ' Next nCount
   ' custCode = coll(chek.IndexOf(-1 * (comp), 0))
   ' numOrder = comp
    
    '''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
    Dim customerNames As Object
    Dim amountPurchased As Object
    
    Dim doesContain As Boolean
    
    Dim checkIndex As Long
    Dim checkLength As Long
    
    Dim ArrayListIndex As Long
    
    Dim maxVal As Long
    
    Dim checkName As String
    Dim finalName As String
    
    Set customerNames = CreateObject("System.Collections.ArrayList")
    Set amountPurchased = CreateObject("System.Collections.ArrayList")
    
    checkLength = Sheets("Check").UsedRange.Rows.count
    
    For checkIndex = 2 To checkLength
        
        checkName = Sheets("Check").Cells(checkIndex, 3)
        doesContain = customerNames.Contains(checkName)
        
        If doesContain = False Then
            customerNames.Add (checkName)
            amountPurchased.Add (0)
        End If
    Next checkIndex
    
    For ArrayListIndex = 0 To customerNames.count - 1
    checkName = customerNames.item(ArrayListIndex)
            For checkIndex = 2 To checkLength
        
                If Sheets("Check").Cells(checkIndex, 3) = checkName Then
                    amountPurchased.item(ArrayListIndex) = amountPurchased.item(ArrayListIndex) + Sheets("Check").Cells(checkIndex, 7)
                End If
                
            Next checkIndex
    Next ArrayListIndex
    
    maxVal = 0
    For ArrayListIndex = 0 To customerNames.count - 1
    Dim aVal As Long
    Dim bVal As Long
    
    aVal = amountPurchased.item(ArrayListIndex)
    aVal = Abs(aVal)
    If aVal > maxVal Then
    maxVal = aVal
    bVal = ArrayListIndex
    End If
    
    Next ArrayListIndex
    
    finalName = customerNames.item(bVal)
    
   ' DONE custCode gives the top customer and numOrder gives how much they ordered
    
    'TOP SALES
   ' Dim cter As Long
   ' Dim ctel As Long
   ' Dim cterone As Long
   ' Dim ctertwo As Long
   ' Dim sales As Object
   ' Dim salesy As Object
   ' Set sales = CreateObject("System.Collections.ArrayList")
   ' ctel = Sheets("Check").UsedRange.Rows.count
   ' Set salesy = CreateObject("System.Collections.ArrayList")
   
    
   ' For cter = 2 To ctel
   ' If sales.Contains(Sheets("Check").Cells(cter, 10)) = False Then
   ' sales.Add (Sheets("Check").Cells(cter, 10))
   ' End If
   ' For cterone = 0 To sales.count
   ' For ctertwo = 2 To ctel
   ' If Sheets("Check").Cells(ctertwo, 10) = sales(cterone) Then
   ' salesy(cterone) = salesy(cterone) + Sheets("Check").Cells(ctertwo, 7)
   ' Next ctertwo
   ' Next cterone
    
   ' Dim maxi As Long
   ' Dim maxiCount As Long
   ' Dim indexMax As Long
    
   ' maxi = 0
   ' For maxiCount = 0 To sales.count
   ' If Abs(salesy(maxiCount)) > maxi Then
   ' maxi = Abs(salesy(maxiCount))
   ' indexMax = sales(maxiCount)
   ' End If
   ' Next maxiCount
    
    'DONE maxi gives total amount sold and indexmax gives the sales code
    
     Dim salesNames As Object
    Dim amountSold As Object
    
    Dim doesContai As Boolean
    
    Dim checkInde As Long
    Dim checkLengt As Long
    
    Dim ArrayListInde As Long
    
    Dim maxVa As Long
    
    Dim checkNam As String
    Dim finalNam As String
    
    Set salesNames = CreateObject("System.Collections.ArrayList")
    Set amountSold = CreateObject("System.Collections.ArrayList")
    
    checkLengt = Sheets("Check").UsedRange.Rows.count
    
    For checkInde = 2 To checkLengt
        
        checkNam = Sheets("Check").Cells(checkInde, 10)
        doesContai = salesNames.Contains(checkNam)
        
        If doesContai = False Then
            salesNames.Add (checkNam)
            amountSold.Add (0)
        End If
    Next checkInde
    
    For ArrayListInde = 0 To salesNames.count - 1
    checkNam = salesNames.item(ArrayListInde)
            For checkInde = 2 To checkLengt
        
                If Sheets("Check").Cells(checkInde, 10) = checkNam Then
                    amountSold.item(ArrayListInde) = amountSold.item(ArrayListInde) + Sheets("Check").Cells(checkInde, 7)
                End If
                
            Next checkInde
    Next ArrayListInde
    
    maxVa = 0
    For ArrayListInde = 0 To salesNames.count - 1
    Dim cVal As Long
    Dim dVal As Long
    
    cVal = amountSold.item(ArrayListInde)
    cVal = Abs(cVal)
    If cVal > maxVa Then
    maxVa = cVal
    dVal = ArrayListInde
    End If
    
    Next ArrayListInde
    
    Dim avgProfit As Double
    Dim legth As Double
    Dim sum As Double
    legth = Sheets("Check").UsedRange.Rows.count - 1
    sum = Application.WorksheetFunction.sum(Sheets("Check").Columns(11).SpecialCells(xlCellTypeVisible))
    avgProfit = sum / legth
    
    finalNam = salesNames.item(dVal)
    freq = (myTable.Resize(, 1).SpecialCells(xlCellTypeVisible).count) - 1
    
    If freq = 0 Then
    freq = 1
    End If
    avgShip = sumqty / freq
    txnMonth = CLng(freq / 12#)
    
    

    Sheets("Ledge").Select
    Sheets("Ledge").Range("$A$1:$A$" & ranger).AutoFilter Field:=1
    Sheets(wsName).Select
    Sheets(wsName).Cells(1, 18) = "Avg qty per month"
    Sheets(wsName).Cells(1, 19) = "Avg Profit"
    Sheets(wsName).Cells(1, 20) = "Avg Qty Trans per Month"
    Sheets(wsName).Cells(1, 23) = "Product Code"
    Sheets(wsName).Cells(1, 24) = "Top Location"
    Sheets(wsName).Cells(1, 25) = "Amount Sold"
    Sheets(wsName).Cells(1, 26) = "Top Month"
    Sheets(wsName).Cells(1, 27) = "Amount Sold"
    Sheets(wsName).Cells(1, 28) = "Top Customer"
    Sheets(wsName).Cells(1, 29) = "Amount Purchased"
    Sheets(wsName).Cells(1, 30) = "Top Sales"
    Sheets(wsName).Cells(1, 31) = "Amount Sold"
    If freq <= 10 Then
    Sheets(wsName).Select
    Sheets(wsName).Cells(reet, 5).Interior.ColorIndex = 4 'green
    ElseIf freq <= 110 Then
    Sheets(wsName).Select
    Sheets(wsName).Cells(reet, 5).Interior.ColorIndex = 6 'yellow
    ElseIf freq <= 500 Then
    Sheets(wsName).Select
    Sheets(wsName).Cells(reet, 5).Interior.ColorIndex = 3 'red
    Else
    Sheets(wsName).Select
    Sheets(wsName).Cells(reet, 5).Interior.ColorIndex = 8 'blue for ceck
    End If
    sumqty = CLng(sumqty / 12#)
    If sumqty > Sheets(wsName).Cells(reet, 1) Then
    Sheets(wsName).Cells(reet, 1).Interior.ColorIndex = 3
    Sheets(wsName).Cells(reet, 18) = sumqty
    Sheets(wsName).Cells(reet, 19) = avgProfit
    Sheets(wsName).Cells(reet, 20) = txnMonth
    Sheets(wsName).Cells(reet, 23) = product
    Sheets(wsName).Cells(reet, 24) = loc
    Sheets(wsName).Cells(reet, 25) = win
    Sheets(wsName).Cells(reet, 26) = mo
    Sheets(wsName).Cells(reet, 27) = max
    Sheets(wsName).Cells(reet, 28) = finalName
    Sheets(wsName).Cells(reet, 29) = maxVal
    Sheets(wsName).Cells(reet, 30) = finalNam
    Sheets(wsName).Cells(reet, 31) = maxVa
    Else
    Sheets(wsName).Cells(reet, 1).Interior.ColorIndex = 4
    Sheets(wsName).Cells(reet, 18) = sumqty
    Sheets(wsName).Cells(reet, 19) = avgProfit
    Sheets(wsName).Cells(reet, 20) = txnMonth
    Sheets(wsName).Cells(reet, 23) = product
    Sheets(wsName).Cells(reet, 24) = loc
    Sheets(wsName).Cells(reet, 25) = win
    Sheets(wsName).Cells(reet, 26) = mo
    Sheets(wsName).Cells(reet, 27) = max
    Sheets(wsName).Cells(reet, 28) = finalName
    Sheets(wsName).Cells(reet, 29) = maxVal
    Sheets(wsName).Cells(reet, 30) = finalNam
    Sheets(wsName).Cells(reet, 31) = maxVa
End If
 Next reet

Sheets(wsName).Columns("R:W").Cut
Sheets(wsName).Range("L1").Insert
If wsName = "MITA" Then
End
End If

Next ws


End Sub
